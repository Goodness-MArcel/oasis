<section class="admin-page-header mb-4">
    <div class="d-flex align-items-center justify-content-between">
        <div>
            <h2 class="h4 mb-1">Course Management</h2>
            <p class="text-muted small mb-0">Add, edit and monitor online courses, training programs and tutorials.</p>
        </div>
        <div class="d-flex gap-2">
            <a href="#" class="btn btn-outline-primary">Import</a>
            <a href="#" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addCourseModal">Add New</a>
        </div>
    </div>
</section>

<section class="admin-overview row g-3 mb-4">
    <div class="col-sm-6 col-lg-3">
        <div class="admin-card p-3 text-center">
            <div class="h3 mb-0">24</div>
            <div class="small text-muted">Online Courses</div>
        </div>
    </div>
    <div class="col-sm-6 col-lg-3">
        <div class="admin-card p-3 text-center">
            <div class="h3 mb-0">12</div>
            <div class="small text-muted">Training Programs</div>
        </div>
    </div>
    <div class="col-sm-6 col-lg-3">
        <div class="admin-card p-3 text-center">
            <div class="h3 mb-0">56</div>
            <div class="small text-muted">Tutorials</div>
        </div>
    </div>
    <div class="col-sm-6 col-lg-3">
        <div class="admin-card p-3 text-center">
            <div class="h3 mb-0">1,230</div>
            <div class="small text-muted">Active Enrollments</div>
        </div>
    </div>
</section>

<section>
    <ul class="nav nav-tabs mb-3" id="manageTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active text-success" id="courses-tab" data-bs-toggle="tab" data-bs-target="#courses" type="button" role="tab">Courses</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link text-success" id="training-tab" data-bs-toggle="tab" data-bs-target="#training" type="button" role="tab">Training</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link text-success" id="tutorials-tab" data-bs-toggle="tab" data-bs-target="#tutorials" type="button" role="tab">Tutorials</button>
        </li>
    </ul>

    <div class="tab-content" id="manageTabsContent">
        <!-- Courses Tab -->
        <div class="tab-pane fade show active" id="courses" role="tabpanel">
            <div class="mb-3 d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Online Courses</h5>
                <div>
                      <a href="#" class="btn btn-sm btn-outline-secondary">Manage Enrollments</a>
                      <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#addCourseModal">Add Course</button>
                </div>
            </div>

            <!-- Placeholder table -->
            <div class="table-responsive admin-card p-0">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Instructor</th>
                            <th>Lessons</th>
                            <th>Enrolled</th>
                            <th>Progress</th>
                            <th class="text-end">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (typeof courses !== 'undefined' && courses && courses.length) { %>
                            <% courses.forEach(function(course){ %>
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <img src="<%= course.image || '/images/python.png' %>" alt="" style="width:64px;height:48px;object-fit:cover;border-radius:6px;margin-right:12px;" />
                                            <div>
                                                <strong><%= course.title %></strong>
                                                <div class="small text-muted"><%= course.category || '' %></div>
                                            </div>
                                        </div>
                                    </td>
                                    <td><%= course.instructorName || '—' %></td>
                                    <td><%= course.lessons != null ? course.lessons : 0 %></td>
                                    <td><%= course.enrolled != null ? course.enrolled : 0 %></td>
                                    <td>
                                        <div class="progress" style="height:8px;">
                                            <% var prog = (course.progress != null) ? course.progress : 0; %>
                                            <div class="progress-bar bg-success" role="progressbar" style="width:<%= Math.max(0, Math.min(100, prog)) %>%"></div>
                                        </div>
                                    </td>
                                    <td class="text-end">
                                        <button type="button" class="btn btn-sm btn-outline-primary btn-edit-course" data-id="<%= course.id %>">Edit</button>
                                        <button type="button" class="btn btn-sm btn-outline-danger btn-delete-course" data-id="<%= course.id %>" style="margin-left:6px;">Delete</button>
                                    </td>
                                </tr>
                            <% }); %>
                        <% } else { %>
                            <tr>
                                <td colspan="6" class="text-center">
                                    <div class="py-4">
                                        <i class="fa-solid fa-graduation-cap fa-2x text-success mb-2" aria-hidden="true"></i>
                                        <div class="h6 mb-1 text-muted">No courses yet</div>
                                        <div class="small text-muted mb-3">Create your first course to make it available to learners.</div>
                                        <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#addCourseModal">
                                            <i class="fa-solid fa-plus me-2"></i>Add Course
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Training Tab -->
        <div class="tab-pane fade" id="training" role="tabpanel">
            <div class="mb-3 d-flex justify-content-between align-items-center">
                <h5 class="mb-0">In-House Training Programs</h5>
                <div>
                    <a href="#" class="btn btn-sm btn-outline-secondary">Manage Enrollments</a>
                    <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#addTrainingModal">Add Training</button>
                </div>
            </div>

            <div class="admin-card p-3">
                <p class="small text-muted mb-2">Manage attendance, schedules and trainees for in-house programs.</p>
                <!-- Placeholder items -->
                <div class="list-group">
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>Leadership Workshop</strong>
                            <div class="small text-muted">Next session: 2026-01-12</div>
                        </div>
                        <div>
                            <a href="#" class="btn btn-sm btn-outline-primary">Attendance</a>
                            <a href="#" class="btn btn-sm btn-outline-danger">Delete</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tutorials Tab -->
        <div class="tab-pane fade" id="tutorials" role="tabpanel">
            <div class="mb-3 d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Free Tutorials</h5>
                <div>
                    <a href="#" class="btn btn-sm btn-outline-secondary">Access Stats</a>
                    <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#addTutorialModal">Add Tutorial</button>
                </div>
            </div>

            <div class="row g-3">
                <div class="col-md-6">
                    <div class="admin-card p-3">
                        <h6 class="mb-1">Build a REST API</h6>
                        <p class="small text-muted mb-2">Views: 3,412 — Progress tracking enabled</p>
                        <div class="d-flex gap-2">
                            <a href="#" class="btn btn-sm btn-outline-primary">Edit</a>
                            <a href="#" class="btn btn-sm btn-outline-danger">Delete</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Small script to preserve tab state if desired -->
<script>
    (function () {
        const triggerTabList = [].slice.call(document.querySelectorAll('#manageTabs button'));
        triggerTabList.forEach(function (triggerEl) {
            const tabTrigger = new bootstrap.Tab(triggerEl);
            triggerEl.addEventListener('click', function (event) {
                event.preventDefault();
                tabTrigger.show();
            });
        });
    })();
</script>

    <div class="modal fade" id="editCourseModal" tabindex="-1" aria-labelledby="editCourseModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editCourseModalLabel">Edit Course</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="editCourseForm" action="" method="post" enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label small">Course Title</label>
                                    <input id="editCourseTitle" name="title" type="text" class="form-control" required />
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small">Category</label>
                                    <input id="editCourseCategory" name="category" type="text" class="form-control" />
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small">Badge (optional)</label>
                                    <input id="editCourseBadge" name="badge" type="text" class="form-control" />
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small">Instructor</label>
                                    <input id="editCourseInstructor" name="instructorName" type="text" class="form-control" />
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small">Image (replace)</label>
                                    <input id="editCourseImage" name="image" type="file" accept="image/*" class="form-control" />
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small">Short description</label>
                                    <textarea id="editCourseDescription" name="description" class="form-control" rows="3"></textarea>
                                </div>
                                <div class="row g-2">
                                    <div class="col-4">
                                        <label class="form-label small">Lessons</label>
                                        <input id="editCourseLessons" name="lessons" type="number" class="form-control" min="0" />
                                    </div>
                                    <div class="col-4">
                                        <label class="form-label small">Enrolled</label>
                                        <input id="editCourseEnrolled" name="enrolled" type="number" class="form-control" min="0" />
                                    </div>
                                    <div class="col-4">
                                        <label class="form-label small">Progress (%)</label>
                                        <input id="editCourseProgress" name="progress" type="number" class="form-control" min="0" max="100" />
                                    </div>
                                </div>
                                <div class="mb-3 mt-2">
                                    <label class="form-label small">Duration (optional)</label>
                                    <input id="editCourseDuration" name="duration" type="text" class="form-control" placeholder="e.g. 6 weeks or 12 hours" />
                                </div>
                                <div class="mb-3 mt-2">
                                    <label class="form-label small">Price (optional)</label>
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text">₦</span>
                                        <input id="editCoursePrice" name="price" type="number" class="form-control" min="0" step="100" />
                                    </div>
                                    <div class="form-text small">Leave empty for free courses.</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small">Current Image</label>
                                <div class="card p-3">
                                    <img id="editCourseCurrentImage" src="/images/python.png" alt="" class="w-100 mb-3" style="height:220px;object-fit:cover;border-radius:6px;" />
                                    <div class="small text-muted" id="editCourseMeta"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title d-flex align-items-center" id="confirmDeleteModalLabel">
                        <i class="fa-solid fa-trash-can fa-lg text-danger me-2" aria-hidden="true"></i>
                        Confirm Delete
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="fa-solid fa-triangle-exclamation fa-3x text-warning mb-3" aria-hidden="true"></i>
                    <p class="mb-1 fw-bold">This will permanently delete the course.</p>
                    <p class="small text-muted mb-0">Are you sure you want to continue? This action cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center border-0">
                    <form id="deleteCourseForm" method="post" action="">
                        <button type="button" class="btn btn-outline-secondary me-2" data-bs-dismiss="modal">
                            <i class="fa-solid fa-xmark me-1"></i>Cancel
                        </button>
                        <button type="submit" class="btn btn-danger">
                            <i class="fa-solid fa-trash me-1"></i>Delete
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Client-side handlers for edit/delete buttons -->
    <script>
        (function(){
            // edit handler
            document.querySelectorAll('.btn-edit-course').forEach(btn => {
                btn.addEventListener('click', async function () {
                    const id = this.dataset.id;
                    try {
                        const res = await fetch(`/admin/courses/${id}/json`);
                        if (!res.ok) throw new Error('Failed to fetch');
                        const body = await res.json();
                        const course = body.course;
                        // populate form
                        document.getElementById('editCourseTitle').value = course.title || '';
                        document.getElementById('editCourseCategory').value = course.category || '';
                        document.getElementById('editCourseBadge').value = course.badge || '';
                        document.getElementById('editCourseInstructor').value = course.instructorName || '';
                        document.getElementById('editCourseDescription').value = course.description || '';
                        document.getElementById('editCourseLessons').value = course.lessons || 0;
                        document.getElementById('editCourseEnrolled').value = course.enrolled || 0;
                        document.getElementById('editCourseProgress').value = course.progress || 0;
                        const editDurationEl = document.getElementById('editCourseDuration');
                        if (editDurationEl) editDurationEl.value = course.duration || '';
                        const editPriceEl = document.getElementById('editCoursePrice');
                        if (editPriceEl) editPriceEl.value = (course.price != null ? course.price : '');
                        document.getElementById('editCourseCurrentImage').src = course.image || '/images/python.png';
                        document.getElementById('editCourseMeta').textContent = `ID: ${course.id} • Created: ${new Date(course.createdAt).toLocaleString()}`;
                        // set form action
                        const form = document.getElementById('editCourseForm');
                        form.action = `/admin/courses/${course.id}/update`;
                        // clear file input
                        const fileIn = document.getElementById('editCourseImage'); if (fileIn) fileIn.value = '';

                        const modalEl = document.getElementById('editCourseModal');
                        const modal = new bootstrap.Modal(modalEl);
                        modal.show();
                    } catch (e) {
                        console.error(e);
                        alert('Unable to load course for editing.');
                    }
                });
            });

            // delete handler
            document.querySelectorAll('.btn-delete-course').forEach(btn => {
                btn.addEventListener('click', function () {
                    const id = this.dataset.id;
                    const form = document.getElementById('deleteCourseForm');
                    form.action = `/admin/courses/${id}/delete`;
                    const modalEl = document.getElementById('confirmDeleteModal');
                    const modal = new bootstrap.Modal(modalEl);
                    modal.show();
                });
            });
        })();
    </script>

<!-- Add Course Modal -->
<div class="modal fade" id="addCourseModal" tabindex="-1" aria-labelledby="addCourseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addCourseModalLabel">Add New Course</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="addCourseForm" action="/admin/courses" method="post" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label small">Course Title</label>
                                <input id="courseTitle" name="title" type="text" class="form-control" placeholder="Python for Data Science" required />
                            </div>
                            <div class="mb-3">
                                <label class="form-label small">Category</label>
                                <input id="courseCategory" name="category" type="text" class="form-control" placeholder="Programming" />
                            </div>
                            <div class="mb-3">
                                <label class="form-label small">Badge (optional)</label>
                                <input id="courseBadge" name="badge" type="text" class="form-control" placeholder="Bestseller" />
                            </div>
                            <div class="mb-3">
                                <label class="form-label small">Instructor</label>
                                <input id="courseInstructor" name="instructorName" type="text" class="form-control" placeholder="Instructor name (admin types)" />
                            </div>
                            <div class="mb-3">
                                <label class="form-label small">Image</label>
                                <input id="courseImage" name="image" type="file" accept="image/*" class="form-control" />
                            </div>
                            <div class="mb-3">
                                <label class="form-label small">Short description</label>
                                <textarea id="courseDescription" name="description" class="form-control" rows="3" placeholder="Short course summary"></textarea>
                            </div>
                            <div class="row g-2">
                                <div class="col-6">
                                    <label class="form-label small">Lessons</label>
                                    <input id="courseLessons" name="lessons" type="number" class="form-control" placeholder="8" min="0" />
                                </div>
                                <div class="col-6">
                                    <label class="form-label small">Enrolled</label>
                                    <input id="courseEnrolled" name="enrolled" type="number" class="form-control" placeholder="2450" min="0" />
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label small">Duration (optional)</label>
                                <input id="courseDuration" name="duration" type="text" class="form-control" placeholder="e.g. 6 weeks or 12 hours" />
                            </div>
                            <div class="mb-3">
                                <label class="form-label small">Price (optional)</label>
                                <div class="input-group input-group-sm">
                                    <span class="input-group-text">₦</span>
                                    <input id="coursePrice" name="price" type="number" class="form-control" placeholder="65000" min="0" step="100" />
                                </div>
                                <div class="form-text small">Leave empty for free courses.</div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label small">Preview</label>
                            <div class="card p-0">
                                <div id="previewCard" class="course-card">
                                    <div class="course-image position-relative">
                                        <img id="previewImage" src="/images/python.png" alt="Preview" class="w-100" />
                                        <span id="previewBadge" class="badge bg-success position-absolute top-0 end-0 m-3">Bestseller</span>
                                    </div>
                                    <div class="course-content p-4">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <span id="previewCategory" class="badge bg-primary">Programming</span>
                                            <div id="previewRating" class="text-warning">
                                                <i class="fa-solid fa-star"></i> 4.8
                                            </div>
                                        </div>
                                        <h4 id="previewTitle" class="course-title">Python for Data Science</h4>
                                        <div class="small text-muted mb-2">By <span id="previewInstructor">Instructor Name</span></div>
                                        <p id="previewDesc" class="text-muted small">Master Python programming and data analysis with hands-on projects.</p>
                                        <div class="d-flex justify-content-between align-items-center mt-3">
                                            <span id="previewEnrolled" class="text-muted small"><i class="fa-solid fa-users"></i> 2,450 students</span>
                                            <span id="previewPrice" class="text-success small fw-semibold">₦65,000</span>
                                        </div>
                                        <div class="mt-2">
                                            <a id="previewLink" href="#" class="btn btn-sm btn-outline-primary">Learn More</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Create Course</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    (function () {
        const title = document.getElementById('courseTitle');
        const category = document.getElementById('courseCategory');
        const badge = document.getElementById('courseBadge');
            const instructor = document.getElementById('courseInstructor');
        const image = document.getElementById('courseImage');
        const desc = document.getElementById('courseDescription');
        const lessons = document.getElementById('courseLessons');
        const enrolled = document.getElementById('courseEnrolled');
        const duration = document.getElementById('courseDuration');
        const price = document.getElementById('coursePrice');

        const pTitle = document.getElementById('previewTitle');
        const pCategory = document.getElementById('previewCategory');
        const pBadge = document.getElementById('previewBadge');
            const pInstructor = document.getElementById('previewInstructor');
        const pImage = document.getElementById('previewImage');
        const pDesc = document.getElementById('previewDesc');
        const pEnrolled = document.getElementById('previewEnrolled');
        const pPrice = document.getElementById('previewPrice');

        let lastImageUrl = null;

        function updatePreview() {
            pTitle.textContent = title.value || 'Course Title';
            pCategory.textContent = category.value || 'Category';
            pInstructor.textContent = (instructor && instructor.value) ? instructor.value : 'Instructor Name';
            if (badge.value) {
                pBadge.textContent = badge.value;
                pBadge.style.display = '';
            } else {
                pBadge.style.display = 'none';
            }

            // handle file input preview
            if (image && image.files && image.files[0]) {
                const file = image.files[0];
                if (lastImageUrl) URL.revokeObjectURL(lastImageUrl);
                lastImageUrl = URL.createObjectURL(file);
                pImage.src = lastImageUrl;
            } else {
                pImage.src = '/images/python.png';
            }

            pDesc.textContent = desc.value || 'Short course summary';
            pEnrolled.innerHTML = `<i class="fa-solid fa-users"></i> ${enrolled.value || '0'} students`;

            if (pPrice) {
                const raw = price && price.value ? price.value.trim() : '';
                if (raw) {
                    pPrice.textContent = `₦${raw}`;
                    pPrice.style.display = '';
                } else {
                    pPrice.textContent = '';
                    pPrice.style.display = 'none';
                }
            }
        }

        // attach listeners: use 'change' for file input, 'input' for others
        [title, category, badge, instructor, desc, lessons, enrolled, duration, price].forEach(el => {
            if (el) el.addEventListener('input', updatePreview);
        });
        if (image) image.addEventListener('change', updatePreview);

        // Initialize preview when modal shown
        const addCourseModal = document.getElementById('addCourseModal');
        addCourseModal.addEventListener('shown.bs.modal', function () { updatePreview(); title.focus(); });

        // revoke object URL when modal hidden to free memory
        addCourseModal.addEventListener('hidden.bs.modal', function () {
            if (lastImageUrl) {
                URL.revokeObjectURL(lastImageUrl);
                lastImageUrl = null;
            }
            // also reset file input so next open is clean
            if (image) image.value = '';
            if (instructor) instructor.value = '';
        });
    })();
</script>

        <!-- Add Training Modal -->
        <div class="modal fade" id="addTrainingModal" tabindex="-1" aria-labelledby="addTrainingModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addTrainingModalLabel">Add In-House Training</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form id="addTrainingForm" action="/admin/trainings" method="post">
                        <div class="modal-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label small">Program Title</label>
                                        <input id="trainingTitle" name="title" type="text" class="form-control" placeholder="Advanced JavaScript & React Workshop" required />
                                    </div>
                                    <div class="row g-2 mb-3">
                                        <div class="col-4">
                                            <label class="form-label small">Day</label>
                                            <input id="trainingDay" name="day" type="text" class="form-control" placeholder="18" />
                                        </div>
                                        <div class="col-8">
                                            <label class="form-label small">Month (abbr)</label>
                                            <input id="trainingMonth" name="month" type="text" class="form-control" placeholder="JAN" />
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label small">Location</label>
                                        <input id="trainingLocation" name="location" type="text" class="form-control" placeholder="Lagos, Nigeria" />
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label small">Duration</label>
                                        <input id="trainingDuration" name="duration" type="text" class="form-control" placeholder="3 Days | 9:00 AM - 5:00 PM" />
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label small">Seats available</label>
                                        <input id="trainingSeats" name="seats" type="number" class="form-control" placeholder="12" min="0" />
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label small">Short description</label>
                                        <textarea id="trainingDescription" name="description" class="form-control" rows="3" placeholder="Deep dive into modern JavaScript and React development with real-world projects."></textarea>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label small">Preview</label>
                                    <div class="card p-3">
                                        <div id="previewTraining" class="training-card p-4">
                                            <div class="d-flex gap-3">
                                                <div class="training-date text-center flex-shrink-0">
                                                    <div id="previewTrainingDay" class="date-day">18</div>
                                                    <div id="previewTrainingMonth" class="date-month">JAN</div>
                                                </div>
                                                <div class="flex-grow-1">
                                                    <h4 id="previewTrainingTitle" class="mb-2">Advanced JavaScript & React Workshop</h4>
                                                    <p id="previewTrainingDesc" class="text-muted mb-3">Deep dive into modern JavaScript and React development with real-world projects.</p>
                                                    <div class="training-meta small text-muted mb-2">
                                                        <div id="previewTrainingLocation"><i class="fa-solid fa-location-dot text-primary"></i> Lagos, Nigeria</div>
                                                        <div id="previewTrainingDuration"><i class="fa-solid fa-clock text-primary"></i> 3 Days | 9:00 AM - 5:00 PM</div>
                                                        <div id="previewTrainingSeats"><i class="fa-solid fa-users text-primary"></i> 12 seats available</div>
                                                    </div>
                                                    <a id="previewTrainingLink" href="#" class="btn btn-sm btn-outline-warning mt-3">Register Now</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-success">Create Training</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <script>
            (function () {
                const tTitle = document.getElementById('trainingTitle');
                const tDay = document.getElementById('trainingDay');
                const tMonth = document.getElementById('trainingMonth');
                const tLocation = document.getElementById('trainingLocation');
                const tDuration = document.getElementById('trainingDuration');
                const tSeats = document.getElementById('trainingSeats');
                const tDesc = document.getElementById('trainingDescription');

                const pTTitle = document.getElementById('previewTrainingTitle');
                const pTDay = document.getElementById('previewTrainingDay');
                const pTMonth = document.getElementById('previewTrainingMonth');
                const pTLocation = document.getElementById('previewTrainingLocation');
                const pTDuration = document.getElementById('previewTrainingDuration');
                const pTSeats = document.getElementById('previewTrainingSeats');
                const pTDesc = document.getElementById('previewTrainingDesc');

                function updateTrainingPreview() {
                    pTTitle.textContent = tTitle.value || 'Training Title';
                    pTDay.textContent = tDay.value || '18';
                    pTMonth.textContent = tMonth.value || 'JAN';
                    pTLocation.innerHTML = `<i class="fa-solid fa-location-dot text-primary"></i> ${tLocation.value || 'Location'}`;
                    pTDuration.innerHTML = `<i class="fa-solid fa-clock text-primary"></i> ${tDuration.value || 'Duration'}`;
                    pTSeats.innerHTML = `<i class="fa-solid fa-users text-primary"></i> ${tSeats.value || '0'} seats available`;
                    pTDesc.textContent = tDesc.value || 'Short description of the training program.';
                }

                [tTitle, tDay, tMonth, tLocation, tDuration, tSeats, tDesc].forEach(el => { if (el) el.addEventListener('input', updateTrainingPreview); });

                const addTrainingModal = document.getElementById('addTrainingModal');
                addTrainingModal.addEventListener('shown.bs.modal', function () { updateTrainingPreview(); tTitle.focus(); });
            })();
        </script>

        <!-- Add Tutorial Modal -->
        <div class="modal fade" id="addTutorialModal" tabindex="-1" aria-labelledby="addTutorialModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addTutorialModalLabel">Add Free Tutorial</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form id="addTutorialForm" action="/admin/tutorials" method="post" enctype="multipart/form-data">
                        <div class="modal-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label small">Tutorial Title</label>
                                        <input id="tutorialTitle" name="title" type="text" class="form-control" placeholder="Programming Basics" required />
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label small">Category</label>
                                        <input id="tutorialCategory" name="category" type="text" class="form-control" placeholder="Programming" />
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label small">Image</label>
                                        <input id="tutorialImage" name="image" type="file" accept="image/*" class="form-control" />
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label small">Short description</label>
                                        <textarea id="tutorialDescription" name="description" class="form-control" rows="3" placeholder="Learn the fundamentals of programming with step-by-step guides."></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label small">Highlights (one per line)</label>
                                        <textarea id="tutorialHighlights" name="highlights" class="form-control" rows="3" placeholder="Variables & Data Types\nControl Flow & Loops\nFunctions & Methods"></textarea>
                                    </div>
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <label class="form-label small">Students</label>
                                            <input id="tutorialStudents" name="students" type="number" class="form-control" placeholder="3250" min="0" />
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label small">Badge</label>
                                            <input id="tutorialBadge" name="badge" type="text" class="form-control" placeholder="FREE" />
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label small">Preview</label>
                                    <div class="card p-0">
                                        <div id="previewTutorial" class="tutorial-card">
                                            <div class="tutorial-image position-relative">
                                                <img id="previewTutorialImage" src="https://images.unsplash.com/photo-1517694712202-14dd9538aa97?w=400&h=250&fit=crop" alt="Preview" class="w-100" />
                                                <span id="previewTutorialBadge" class="badge bg-success position-absolute top-0 start-0 m-3">FREE</span>
                                            </div>
                                            <div class="tutorial-content p-3">
                                                <div class="d-flex justify-content-between align-items-start mb-2">
                                                    <span id="previewTutorialCategory" class="badge bg-primary">Programming</span>
                                                    <div id="previewTutorialRating" class="text-warning small">
                                                        <i class="fa-solid fa-star"></i> 4.8
                                                    </div>
                                                </div>
                                                <h4 id="previewTutorialTitle" class="tutorial-title">Programming Basics</h4>
                                                <p id="previewTutorialDesc" class="text-muted small mb-3">Learn the fundamentals of programming with step-by-step guides.</p>
                                                <ul id="previewTutorialList" class="list-unstyled small mb-3">
                                                    <li class="mb-2"><i class="fa-solid fa-circle-check text-success"></i> Variables & Data Types</li>
                                                    <li class="mb-2"><i class="fa-solid fa-circle-check text-success"></i> Control Flow & Loops</li>
                                                    <li class="mb-2"><i class="fa-solid fa-circle-check text-success"></i> Functions & Methods</li>
                                                </ul>
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <span id="previewTutorialStudents" class="text-muted small"><i class="fa-solid fa-users"></i> 3,250 students</span>
                                                    <a id="previewTutorialLink" href="#" class="btn btn-sm btn-outline-primary">Start Learning</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-success">Create Tutorial</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <script>
                (function () {
                    const title = document.getElementById('tutorialTitle');
                    const category = document.getElementById('tutorialCategory');
                    const image = document.getElementById('tutorialImage');
                    const desc = document.getElementById('tutorialDescription');
                    const highlights = document.getElementById('tutorialHighlights');
                    const students = document.getElementById('tutorialStudents');
                    const badge = document.getElementById('tutorialBadge');

                    const pTitle = document.getElementById('previewTutorialTitle');
                    const pCategory = document.getElementById('previewTutorialCategory');
                    const pImage = document.getElementById('previewTutorialImage');
                    const pDesc = document.getElementById('previewTutorialDesc');
                    const pList = document.getElementById('previewTutorialList');
                    const pStudents = document.getElementById('previewTutorialStudents');
                    const pBadge = document.getElementById('previewTutorialBadge');

                    let lastTutorialImageUrl = null;

                    function updateTutorialPreview() {
                        pTitle.textContent = title.value || 'Programming Basics';
                        pCategory.textContent = category.value || 'Programming';
                        if (badge && badge.value) { pBadge.textContent = badge.value; pBadge.style.display = ''; }
                        else { pBadge.textContent = 'FREE'; pBadge.style.display = ''; }

                        // file input preview
                        if (image && image.files && image.files[0]) {
                            const file = image.files[0];
                            if (lastTutorialImageUrl) URL.revokeObjectURL(lastTutorialImageUrl);
                            lastTutorialImageUrl = URL.createObjectURL(file);
                            pImage.src = lastTutorialImageUrl;
                        } else {
                            pImage.src = 'https://images.unsplash.com/photo-1517694712202-14dd9538aa97?w=400&h=250&fit=crop';
                        }

                        pDesc.textContent = desc.value || 'Learn the fundamentals of programming with step-by-step guides.';
                        const lines = (highlights.value || 'Variables & Data Types\nControl Flow & Loops\nFunctions & Methods').split('\n').map(l => l.trim()).filter(Boolean);
                        pList.innerHTML = lines.map(l => `<li class="mb-2"><i class="fa-solid fa-circle-check text-success"></i> ${l}</li>`).join('');
                        pStudents.innerHTML = `<i class="fa-solid fa-users"></i> ${students.value || '0'} students`;
                    }

                    [title, category, desc, highlights, students, badge].forEach(el => { if (el) el.addEventListener('input', updateTutorialPreview); });
                    if (image) image.addEventListener('change', updateTutorialPreview);

                    const addTutorialModal = document.getElementById('addTutorialModal');
                    addTutorialModal.addEventListener('shown.bs.modal', function () { updateTutorialPreview(); title.focus(); });

                    addTutorialModal.addEventListener('hidden.bs.modal', function () {
                        if (lastTutorialImageUrl) {
                            URL.revokeObjectURL(lastTutorialImageUrl);
                            lastTutorialImageUrl = null;
                        }
                        if (image) image.value = '';
                    });
                })();
        </script>